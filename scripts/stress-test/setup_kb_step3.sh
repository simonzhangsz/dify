#!/bin/bash

# ä¼ä¸šçŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿ - æ­¥éª¤ 3: åˆ›å»ºçŸ¥è¯†åº“

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘   æ­¥éª¤ 3: åˆ›å»ºä¼ä¸šçŸ¥è¯†åº“                               â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

echo "çŽ°åœ¨æˆ‘ä»¬è¦åˆ›å»ºä¸åŒç±»åˆ«çš„çŸ¥è¯†åº“ã€‚"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ðŸ“š æŽ¨èçš„çŸ¥è¯†åº“åˆ†ç±»"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1. äº§å“çŸ¥è¯†åº“"
echo "   - äº§å“æ‰‹å†Œã€åŠŸèƒ½è¯´æ˜Žã€ä½¿ç”¨æŒ‡å—"
echo "   - é€‚åˆ: å®¢æˆ·å’¨è¯¢ã€äº§å“æ”¯æŒ"
echo ""
echo "2. æŠ€æœ¯çŸ¥è¯†åº“"
echo "   - æŠ€æœ¯æ–‡æ¡£ã€API æ–‡æ¡£ã€æ•…éšœæŽ’æŸ¥"
echo "   - é€‚åˆ: æŠ€æœ¯æ”¯æŒã€å¼€å‘äººå‘˜"
echo ""
echo "3. HR çŸ¥è¯†åº“"
echo "   - å…¥èŒæŒ‡å—ã€å‡æœŸæ”¿ç­–ã€ç¦åˆ©åˆ¶åº¦"
echo "   - é€‚åˆ: å‘˜å·¥è‡ªåŠ©æœåŠ¡"
echo ""
echo "4. è´¢åŠ¡çŸ¥è¯†åº“"
echo "   - æŠ¥é”€æµç¨‹ã€è´¢åŠ¡åˆ¶åº¦ã€å‘ç¥¨ç®¡ç†"
echo "   - é€‚åˆ: è´¢åŠ¡ç›¸å…³é—®é¢˜"
echo ""
echo "5. å…¬å¸æ”¿ç­–åº“"
echo "   - ç®¡ç†åˆ¶åº¦ã€å®‰å…¨è§„èŒƒã€æµç¨‹æ–‡æ¡£"
echo "   - é€‚åˆ: åˆè§„æ€§é—®é¢˜"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ðŸ’¡ åˆ›å»ºçŸ¥è¯†åº“æ­¥éª¤ (åœ¨ Web UI ä¸­æ“ä½œ)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1. åœ¨ Dify Web UI ä¸­:"
echo "   http://localhost:3000"
echo ""
echo "2. å¯¼èˆªåˆ° 'Knowledge' é¡µé¢"
echo ""
echo "3. ç‚¹å‡» '+ Create Knowledge Base' (åˆ›å»ºçŸ¥è¯†åº“)"
echo ""
echo "4. å¡«å†™çŸ¥è¯†åº“ä¿¡æ¯:"
echo "   â€¢ Name: äº§å“çŸ¥è¯†åº“"
echo "   â€¢ Description: äº§å“ç›¸å…³æ–‡æ¡£å’Œå¸¸è§é—®é¢˜"
echo "   â€¢ Indexing Mode: High Quality (é«˜è´¨é‡ç´¢å¼•)"
echo "   â€¢ Retrieval Setting:"
echo "     - Vector Search (å‘é‡æœç´¢)"
echo "     - Top K: 5"
echo "     - Score Threshold: 0.7"
echo ""
echo "5. ç‚¹å‡» 'Create'"
echo ""
echo "6. ä¸Šä¼ æ–‡æ¡£:"
echo "   - æ”¯æŒ: PDF, Word, TXT, Markdown"
echo "   - å¯ä»¥æ‰¹é‡ä¸Šä¼ "
echo "   - æˆ–è€…ç›´æŽ¥è¾“å…¥æ–‡æœ¬"
echo ""
echo "7. ç­‰å¾…æ–‡æ¡£å¤„ç†å®Œæˆ"
echo ""
echo "8. é‡å¤æ­¥éª¤ 3-7 åˆ›å»ºå…¶ä»–çŸ¥è¯†åº“"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ðŸ“ ç¤ºä¾‹æ–‡æ¡£å‡†å¤‡"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

read -p "æ˜¯å¦ç”Ÿæˆç¤ºä¾‹æ–‡æ¡£? (y/n) " -n 1 -r
echo ""

if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo ""
    echo "ç”Ÿæˆç¤ºä¾‹æ–‡æ¡£åˆ° /tmp/kb_samples/..."
    
    mkdir -p /tmp/kb_samples/product
    mkdir -p /tmp/kb_samples/technical
    mkdir -p /tmp/kb_samples/hr
    
    # äº§å“çŸ¥è¯†åº“ç¤ºä¾‹
    cat > /tmp/kb_samples/product/product_intro.md << 'EOF'
# äº§å“ä»‹ç»

## äº§å“æ¦‚è¿°

æˆ‘ä»¬çš„äº§å“æ˜¯ä¸€ä¸ªä¼ä¸šçº§æ™ºèƒ½é—®ç­”ç³»ç»Ÿï¼Œå¸®åŠ©ä¼ä¸šæž„å»ºå†…éƒ¨çŸ¥è¯†åº“ã€‚

## æ ¸å¿ƒåŠŸèƒ½

### 1. æ™ºèƒ½é—®ç­”
- è‡ªç„¶è¯­è¨€ç†è§£
- ç²¾å‡†ç­”æ¡ˆæ£€ç´¢
- ä¸Šä¸‹æ–‡è®°å¿†
- å¤šè½®å¯¹è¯

### 2. çŸ¥è¯†ç®¡ç†
- æ–‡æ¡£ä¸Šä¼ å’Œç®¡ç†
- è‡ªåŠ¨åˆ†ç±»å’Œæ ‡ç­¾
- ç‰ˆæœ¬æŽ§åˆ¶
- æƒé™ç®¡ç†

### 3. å¤šæ¸ é“é›†æˆ
- Web ç•Œé¢
- API æŽ¥å£
- ä¼ä¸šå¾®ä¿¡
- é’‰é’‰

## å¸¸è§é—®é¢˜

### Q: æ”¯æŒå“ªäº›æ–‡æ¡£æ ¼å¼ï¼Ÿ
A: æ”¯æŒ PDFã€Wordã€Excelã€TXTã€Markdown ç­‰å¸¸è§æ ¼å¼ã€‚

### Q: å¦‚ä½•æé«˜ç­”æ¡ˆå‡†ç¡®çŽ‡ï¼Ÿ
A: 
1. æä¾›é«˜è´¨é‡çš„çŸ¥è¯†åº“æ–‡æ¡£
2. ä½¿ç”¨æ¸…æ™°çš„æ–‡æ¡£ç»“æž„
3. å®šæœŸæ›´æ–°çŸ¥è¯†åº“
4. æ”¶é›†ç”¨æˆ·åé¦ˆä¼˜åŒ–

### Q: æ˜¯å¦æ”¯æŒå¤šè¯­è¨€ï¼Ÿ
A: æ˜¯çš„ï¼Œæ”¯æŒä¸­æ–‡ã€è‹±æ–‡ç­‰å¤šç§è¯­è¨€ã€‚

### Q: æ•°æ®å®‰å…¨å¦‚ä½•ä¿è¯ï¼Ÿ
A: æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°æœåŠ¡å™¨ï¼Œæ”¯æŒåŠ å¯†ä¼ è¾“å’Œè®¿é—®æŽ§åˆ¶ã€‚
EOF

    # æŠ€æœ¯çŸ¥è¯†åº“ç¤ºä¾‹
    cat > /tmp/kb_samples/technical/api_guide.md << 'EOF'
# API ä½¿ç”¨æŒ‡å—

## API åŸºç¡€

### æŽ¥å£åœ°å€
```
ç”Ÿäº§çŽ¯å¢ƒ: https://api.example.com/v1
æµ‹è¯•çŽ¯å¢ƒ: https://test-api.example.com/v1
```

### è®¤è¯æ–¹å¼
ä½¿ç”¨ Bearer Token è®¤è¯ï¼š
```
Authorization: Bearer YOUR_API_KEY
```

## é—®ç­”æŽ¥å£

### å‘é€é—®é¢˜
```bash
POST /v1/chat-messages

Headers:
  Authorization: Bearer YOUR_API_KEY
  Content-Type: application/json

Body:
{
  "query": "å¦‚ä½•é‡ç½®å¯†ç ï¼Ÿ",
  "user": "user-123",
  "response_mode": "blocking"
}

Response:
{
  "answer": "é‡ç½®å¯†ç æ­¥éª¤ï¼š1. ç‚¹å‡»ç™»å½•é¡µçš„'å¿˜è®°å¯†ç '...",
  "conversation_id": "conv-abc123",
  "message_id": "msg-def456"
}
```

### é”™è¯¯ä»£ç 

| ä»£ç  | è¯´æ˜Ž | è§£å†³æ–¹æ¡ˆ |
|-----|------|---------|
| 401 | è®¤è¯å¤±è´¥ | æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡® |
| 429 | è¯·æ±‚è¿‡å¿« | é™ä½Žè¯·æ±‚é¢‘çŽ‡ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | è”ç³»æŠ€æœ¯æ”¯æŒ |

## å¸¸è§é—®é¢˜

### Q: API æœ‰è¯·æ±‚é™åˆ¶å—ï¼Ÿ
A: æ˜¯çš„ï¼Œé»˜è®¤æ¯åˆ†é’Ÿ 60 æ¬¡è¯·æ±‚ã€‚å¦‚éœ€æé«˜é™åˆ¶ï¼Œè¯·è”ç³»æˆ‘ä»¬ã€‚

### Q: å¦‚ä½•å¤„ç†é•¿æ—¶é—´å“åº”ï¼Ÿ
A: ä½¿ç”¨æµå¼å“åº”æ¨¡å¼ `response_mode: "streaming"`ã€‚

### Q: æ”¯æŒæ‰¹é‡æŸ¥è¯¢å—ï¼Ÿ
A: æ”¯æŒï¼Œä½¿ç”¨ `/v1/batch-query` ç«¯ç‚¹ã€‚
EOF

    # HR çŸ¥è¯†åº“ç¤ºä¾‹
    cat > /tmp/kb_samples/hr/leave_policy.md << 'EOF'
# ä¼‘å‡åˆ¶åº¦

## å¹´å‡æ”¿ç­–

### å¹´å‡å¤©æ•°

| å·¥é¾„ | å¹´å‡å¤©æ•° |
|------|---------|
| 1å¹´ä»¥ä¸‹ | 0 å¤© |
| 1-5å¹´ | 5 å¤© |
| 5-10å¹´ | 10 å¤© |
| 10å¹´ä»¥ä¸Š | 15 å¤© |

### ç”³è¯·æµç¨‹

1. **æå‰ç”³è¯·**
   - è‡³å°‘æå‰ 3 å¤©ç”³è¯·
   - èŠ‚å‡æ—¥éœ€æå‰ 7 å¤©

2. **åœ¨çº¿ç”³è¯·**
   - ç™»å½• HR ç³»ç»Ÿ
   - é€‰æ‹©"è¯·å‡ç”³è¯·"
   - å¡«å†™è¯·å‡ä¿¡æ¯
   - æäº¤å®¡æ‰¹

3. **å®¡æ‰¹æµç¨‹**
   - ç›´å±žä¸Šçº§å®¡æ‰¹
   - HR ç¡®è®¤
   - ç³»ç»Ÿè‡ªåŠ¨é€šçŸ¥

4. **å‡æœŸä½¿ç”¨è§„åˆ™**
   - å½“å¹´æœ‰æ•ˆï¼Œä¸å¯è·¨å¹´
   - å¯ä»¥æŒ‰åŠå¤©æˆ–æ•´å¤©è¯·å‡
   - å›½å®¶æ³•å®šèŠ‚å‡æ—¥ä¸è®¡å…¥å¹´å‡

## ç—…å‡æ”¿ç­–

### ç—…å‡å¤©æ•°
- å‡­åŒ»é™¢è¯æ˜Ž
- æ¯å¹´ç´¯è®¡ä¸è¶…è¿‡ 90 å¤©
- è¶…è¿‡ 3 å¤©éœ€æä¾›è¯Šæ–­è¯æ˜Ž

### ç—…å‡å·¥èµ„
- å‰ 3 å¤©: 100% å·¥èµ„
- 4-30 å¤©: 80% å·¥èµ„
- 31-90 å¤©: 60% å·¥èµ„

## å…¶ä»–å‡æœŸ

### å©šå‡
- 3 å¤©å¸¦è–ªå‡æœŸ
- éœ€æä¾›ç»“å©šè¯å¤å°ä»¶

### äº§å‡
- 98 å¤©åŸºç¡€äº§å‡
- éš¾äº§å¢žåŠ  15 å¤©
- å¤šèƒžèƒŽæ¯å¤šä¸€ä¸ªå©´å„¿å¢žåŠ  15 å¤©

### é™ªäº§å‡
- 15 å¤©é™ªäº§å‡
- éœ€åœ¨é…å¶äº§å‡æœŸé—´ä½¿ç”¨

## å¸¸è§é—®é¢˜

### Q: å¹´å‡å¯ä»¥ä¸€æ¬¡æ€§ä¼‘å®Œå—ï¼Ÿ
A: å¯ä»¥ï¼Œä½†å»ºè®®åˆ†æ®µä½¿ç”¨ï¼Œä»¥å…å½±å“å·¥ä½œã€‚

### Q: å¹´å‡æ²¡ç”¨å®Œæ€Žä¹ˆåŠžï¼Ÿ
A: å¹´åº•æœªä½¿ç”¨çš„å¹´å‡å°†æ¸…é›¶ï¼Œå»ºè®®æå‰è§„åˆ’ã€‚

### Q: ç—…å‡éœ€è¦ä»€ä¹ˆè¯æ˜Žï¼Ÿ
A: éœ€è¦åŒ»é™¢å¼€å…·çš„ç—…å‡æ¡æˆ–è¯Šæ–­è¯æ˜Žã€‚

### Q: å¦‚ä½•æŸ¥è¯¢å‰©ä½™å¹´å‡ï¼Ÿ
A: ç™»å½• HR ç³»ç»Ÿï¼Œåœ¨"æˆ‘çš„å‡æœŸ"ä¸­æŸ¥çœ‹ã€‚
EOF

    echo ""
    echo "âœ… ç¤ºä¾‹æ–‡æ¡£å·²ç”Ÿæˆï¼"
    echo ""
    echo "ðŸ“ æ–‡æ¡£ä½ç½®:"
    echo "   /tmp/kb_samples/product/product_intro.md"
    echo "   /tmp/kb_samples/technical/api_guide.md"
    echo "   /tmp/kb_samples/hr/leave_policy.md"
    echo ""
    echo "ðŸ’¡ åœ¨ Dify Web UI ä¸­ä¸Šä¼ è¿™äº›æ–‡æ¡£åˆ°å¯¹åº”çš„çŸ¥è¯†åº“"
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… çŸ¥è¯†åº“åˆ›å»ºå®ŒæˆåŽï¼Œç»§ç»­ä¸‹ä¸€æ­¥:"
echo "   ./scripts/stress-test/setup_kb_step4.sh"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
